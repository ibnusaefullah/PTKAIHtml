<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pemantauan 7 Kebiasaan Anak Indonesia Hebat (7 KAIH)</title>
    
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Poppins -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- jsPDF for PDF Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #FAFAFA; /* Instagram's light grey background */
        }

        .instagram-card {
            background: #FFFFFF;
            border: 1px solid #DBDBDB;
            border-radius: 8px;
        }

        .input-field {
            background-color: #FAFAFA;
            border: 1px solid #DBDBDB;
            border-radius: 6px;
            padding: 10px;
            width: 100%;
        }
        .input-field:focus {
            outline: none;
            border-color: #A8A8A8;
        }

        /* Custom toggle switch */
        .toggle-checkbox:checked {
            right: 0;
            border-color: #3897f0;
        }
        .toggle-checkbox:checked + .toggle-label {
            background-color: #3897f0;
        }
    </style>
</head>
<body class="min-h-screen w-full flex items-center justify-center p-4">

    <div class="container mx-auto max-w-md">
        
        <main class="instagram-card">
            <!-- Header -->
            <header class="text-center p-4 border-b border-gray-200">
                <h1 class="text-xl font-semibold text-gray-800">Pemantauan 7 Kebiasaan Hebat</h1>
                <p class="text-sm text-gray-500">UPTD SD Negeri 3 Pekandangan</p>
            </header>

            <div class="p-4">
                <form id="habit-form">
                    <!-- Student Info -->
                    <div class="flex items-center gap-4 mb-6">
                       <div class="w-12 h-12 bg-gray-200 rounded-full flex items-center justify-center flex-shrink-0">
                           <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>
                       </div>
                       <div class="flex-1 space-y-1.5">
                           <input type="text" id="student-name" name="student-name" required placeholder="Nama Siswa" class="input-field font-semibold">
                           <input type="text" id="student-class" name="student-class" required placeholder="Kelas" class="input-field text-sm">
                           <input type="text" id="date" name="date" readonly class="input-field text-sm text-gray-500 bg-gray-100 cursor-not-allowed">
                       </div>
                    </div>

                    <!-- Habits Checklist -->
                    <div id="habits-container" class="space-y-4">
                        <!-- Habits will be injected here by JavaScript -->
                    </div>

                    <!-- Action Buttons -->
                    <div class="mt-6">
                        <button type="submit" id="save-button" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2.5 px-6 rounded-lg transition">
                            Posting Aktivitas Hari Ini
                        </button>
                    </div>
                </form>
                 <div class="mt-4 pt-4 border-t border-gray-200 flex items-center justify-around gap-4">
                        <button type="button" id="generate-pdf" class="text-sm text-gray-600 hover:text-blue-500 transition">Unduh PDF Ortu</button>
                        <a href="#" id="teacher-report-link" target="_blank" class="text-sm text-gray-600 hover:text-blue-500 transition">Laporan Guru</a>
                    </div>
            </div>
        </main>
    </div>
    
    <!-- Notification Modal -->
    <div id="notification-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl p-8 w-full max-w-sm text-center">
            <p id="notification-message" class="text-lg text-gray-700"></p>
            <button id="close-modal" class="mt-6 w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg">OK</button>
        </div>
    </div>


    <script>
        // --- CONFIGURATION ---
        const GOOGLE_APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxq0hOHkcFxiqgsDs8mAr4-7GoUvIxWS7gtT3RBq8w06IkIDy4rFygQ_UsUpBy1xrBVZg/exec';
        const GOOGLE_SHEET_ID = '18itOsbCXtOWJoL9mFHRuk6zRA9saOAH_7pbmsJPkllE';
        const PLACEHOLDER_URL = 'PASTE_YOUR_APPS_SCRIPT_URL_HERE';
        const PLACEHOLDER_SHEET_ID = 'PASTE_YOUR_GOOGLE_SHEET_ID_HERE';

        const habits = [
            { name: "Bangun Pagi", icon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" /></svg>`, hasTimeInput: true },
            { name: "Taat Beribadah", icon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>` },
            { name: "Berolahraga", icon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>` },
            { name: "Makan Sehat dan Bergizi", icon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-12v4m-2-2h4m5 4v4m-2-2h4M17 3v4m2-2h-4m-2 14v4m2-2h-4" /></svg>` },
            { name: "Gemar Belajar", icon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v11.494m-9-5.747h18" /></svg>` },
            { name: "Aktif Bermasyarakat", icon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" /></svg>` },
            { name: "Tidur Cepat", icon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>`, hasTimeInput: true }
        ];

        // --- Date Options ---
        const dateOptions = { weekday: 'long', day: '2-digit', month: 'long', year: 'numeric' };

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            const dateField = document.getElementById('date');
            dateField.value = new Date().toLocaleDateString('id-ID', dateOptions);

            const habitsContainer = document.getElementById('habits-container');
            habits.forEach(habit => {
                const habitId = habit.name.toLowerCase().replace(/\s+/g, '-');
                const timeInputHTML = habit.hasTimeInput 
                    ? `<input type="time" id="${habitId}-time" class="input-field text-sm w-28 mx-2 p-1.5">` 
                    : '';
                
                const card = `
                    <div class="habit-post flex items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-200">
                        <div class="flex items-center gap-3 flex-grow">
                            <span class="text-gray-500">${habit.icon}</span>
                            <span class="text-gray-700 font-medium">${habit.name}</span>
                        </div>
                        ${timeInputHTML}
                        <div class="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in flex-shrink-0">
                            <input type="checkbox" name="${habitId}" id="${habitId}" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                            <label for="${habitId}" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"></label>
                        </div>
                    </div>
                `;
                habitsContainer.innerHTML += card;
            });

            const teacherLink = document.getElementById('teacher-report-link');
            if (GOOGLE_SHEET_ID !== PLACEHOLDER_SHEET_ID) {
                teacherLink.href = `https://docs.google.com/spreadsheets/d/${GOOGLE_SHEET_ID}/edit?usp=sharing`;
            } else {
                 teacherLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    showModal('Harap konfigurasi Google Sheet ID di dalam kode terlebih dahulu.', true);
                });
            }

            document.getElementById('habit-form').addEventListener('submit', handleFormSubmit);
            document.getElementById('generate-pdf').addEventListener('click', generateParentReflectionPDF);
            document.getElementById('close-modal').addEventListener('click', hideModal);
        });

        // --- FUNCTIONS ---
        function showModal(message, isError = false) {
            const modal = document.getElementById('notification-modal');
            const messageElement = document.getElementById('notification-message');
            messageElement.textContent = message;
            messageElement.classList.toggle('text-red-600', isError);
            modal.classList.remove('hidden');
        }

        function hideModal() {
            document.getElementById('notification-modal').classList.add('hidden');
        }

        function handleFormSubmit(e) {
            e.preventDefault();
            if (GOOGLE_APPS_SCRIPT_URL === PLACEHOLDER_URL) {
                showModal('Aplikasi belum terkonfigurasi. Harap salin URL Google Apps Script Anda ke dalam kode HTML.', true);
                return;
            }

            const saveButton = document.getElementById('save-button');
            saveButton.disabled = true;
            saveButton.textContent = 'Memposting...';

            const studentName = document.getElementById('student-name').value;
            const studentClass = document.getElementById('student-class').value;
            const date = new Date().toLocaleDateString('id-ID', dateOptions);
            
            let score = 0;
            const habitData = {};
            habits.forEach(habit => {
                const habitId = habit.name.toLowerCase().replace(/\s+/g, '-');
                const isChecked = document.getElementById(habitId).checked;
                habitData[habit.name] = isChecked ? 1 : 0;
                if (isChecked) score++;

                if (habit.hasTimeInput) {
                    const timeValue = document.getElementById(`${habitId}-time`).value;
                    const timeKey = 'waktu' + habit.name.split(' ').join('');
                    habitData[timeKey] = timeValue;
                }
            });

            const formData = { 
                nama: studentName, 
                kelas: studentClass, 
                tanggal: date, 
                ...habitData, 
                totalSkor: score 
            };
            
            fetch(GOOGLE_APPS_SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                cache: 'no-cache',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(formData)
            })
            .then(() => {
                 showModal('ðŸŽ‰ Aktivitas berhasil diposting! Hebat!');
                 document.getElementById('habit-form').reset();
                 document.getElementById('date').value = new Date().toLocaleDateString('id-ID', dateOptions);
            })
            .catch(error => {
                console.error('Error:', error);
                showModal('Gagal memposting. Coba lagi atau hubungi guru.', true);
            })
            .finally(() => {
                saveButton.disabled = false;
                saveButton.textContent = 'Posting Aktivitas Hari Ini';
            });
        }
        
        async function generateParentReflectionPDF() {
             const studentName = document.getElementById('student-name').value;
            const studentClass = document.getElementById('student-class').value;

            if (!studentName || !studentClass) {
                showModal("Harap isi Nama dan Kelas terlebih dahulu sebelum membuat PDF.", true);
                return;
            }
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            const pageWidth = doc.internal.pageSize.getWidth();
            const margin = 20;
            let cursorY = margin;

            // Header
            doc.setFont("helvetica", "bold");
            doc.setFontSize(18);
            doc.text("Lembar Refleksi Orang Tua - 7 KAIH", pageWidth / 2, cursorY, { align: "center" });
            cursorY += 10;
            
            doc.setFontSize(12);
            doc.setFont("helvetica", "normal");
            doc.text(`Bulan: ${new Date().toLocaleDateString('id-ID', { month: 'long', year: 'numeric'})}`, margin, cursorY);
            cursorY += 8;

            doc.text(`Nama Siswa: ${studentName}`, margin, cursorY);
            doc.text(`Kelas: ${studentClass}`, pageWidth - margin, cursorY, { align: "right" });
            cursorY += 15;

            // Reflection sections
            habits.forEach(habit => {
                if (cursorY > 260) { // Check for page break
                    doc.addPage();
                    cursorY = margin;
                }
                
                doc.setFont("helvetica", "bold");
                doc.setFontSize(12);
                doc.text(habit.name, margin, cursorY);
                cursorY += 8;
                
                doc.setFont("helvetica", "normal");
                doc.setFontSize(10);
                doc.text("Kesimpulan/Refleksi:", margin + 5, cursorY);
                cursorY += 20; // Space for writing
                doc.line(margin + 5, cursorY - 1, pageWidth - margin, cursorY - 1); 
                doc.line(margin + 5, cursorY - 9, pageWidth - margin, cursorY - 9); 

                cursorY += 5;

                doc.text("Tindak Lanjut:", margin + 5, cursorY);
                cursorY += 20; // Space for writing
                doc.line(margin + 5, cursorY - 1, pageWidth - margin, cursorY - 1);
                doc.line(margin + 5, cursorY - 9, pageWidth - margin, cursorY - 9);

                cursorY += 10;
            });

            doc.save(`Refleksi_Ortu_${studentName.replace(/\s/g, '_')}.pdf`);
        }
    </script>
</body>
</html>
